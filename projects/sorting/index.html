<!-- TODO
* Tidy up gross code that I wrote to meet my deadline
  * Clean up all the JS in this file and move it to their own files
  * Find areas with repeated or duplicated code and do a DRY refactoring
-->

<html>
  <head>
    <title>SI 649 Individual Project - Jackson Hammond</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script src='js/sorting.js'></script>
    <script src='js/myScripts.js'></script>

    <link rel="stylesheet" href="css/myStyles.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">

  </head>
  <body>
    <div class="container">
      <h1>Let's Learn Sorting</h1>
      <h2>Algorithm Investigation</h2>
      <p>Choose an algorithm below to learn more about how it works, see its pseudo code, and watch it sort an array step by step.</p>
      <p>Elements being compared are <span style="color: #7156FF;"><b>purple</b></span>, and elements being swapped are <span style="color: #34CC31;"><b>green</b></span>.</p>
      <label for='#algo-select'>Algorithm</label>
      <select class='form-control' id='algo-select' onchange='algoChange()'>
        <option value='bubblesort'>Bubble sort</option>
        <option value='selectionsort'>Selection sort</option>
        <option value='insertionsort'>Insertion sort</option>
        <option value='odd_even_sort'>Odd-even sort</option>
        <option value='cocktail_sort'>Cocktail sort</option>
        <option value='quicksort'>Quicksort</option>
        <option value='heapsort'>Heapsort</option>
        <option value='mergesort'>Merge sort</option>
        <option value='introsort'>Introsort</option>
      </select>
      <div class="row">
        <div class="column">
          <h4>Explanation</h4>
          <p id='english-copy'></p>
          <h4>Pseudo code</h4>
          <pre><code style=display:block;white-space:pre-wrap id='pseudocode-copy'></code></pre>
          <p><a href='' target="_blank" id='source-link'>Read More</a></p>
        </div>
        <div class="column">
          <div class="algorithmInputs">
            <div>
              <label for='#array-size'>Array Size</label>
              <select id='array-size'>
                <option value='10'>10</option>
                <option value='20'>20</option>
                <option value='50'>50</option>
              </select>
            </div>
            <div>
              <label for='#init-select'>Initial array</label>
              <select class='form-control' id='init-select'>
                <option value='random'>Random</option>
                <option value='sorted'>Sorted</option>
                <option value='reversed'>Reversed</option>
              </select>
            </div>
            <div id='pivot-select-div'>
              <label for='#pivot-select'>Pivot choice</label>
              <select class='form-control' id='pivot-select'>
                <option value='random'>Random</option>
                <option value='first'>First</option>
                <option value='middle'>Middle</option>
                <option value='last'>Last</option>
                <option value='median3'>Median of 3</option>
              </select>
            </div>
            <div>
              <label for='#interval'>Interval (ms)</label>
              <input id='interval' class='form-control' type='number' value="100"/>
            </div>
          </div>
          <canvas id="myChart2"></canvas>
          <button id="start-btn">
              Sort
          </button>
          <button id="resetBtn">
              Reset
          </button>
          <canvas id="main-line-chart" class="hidden"></canvas>
        </div>
      </div>

      <h2>Algorithm Comparison</h2>
      <p>Choose two algorithms below and click "Compare" to watch how their performance compares to one another. Once they're both completed click "Reset" to shuffle the arrays and start again.</p>
      <div>
        <button id='startRace'>Compare</button>
        <button id='resetRace'>Reset</button>
      </div>

      <div class="row">
        <div class="column">
          <div class="algorithmInputs">
            <div>
              <label for='#bottom-comparison-1'>Algorithm</label>
              <select class='form-control' id='bottom-comparison-1'>
                <option value='bubblesort'>Bubble sort</option>
                <option value='selectionsort'>Selection sort</option>
                <option value='insertionsort'>Insertion sort</option>
                <option value='odd_even_sort'>Odd-even sort</option>
                <option value='cocktail_sort'>Cocktail sort</option>
                <option value='quicksort'>Quicksort</option>
                <option value='heapsort'>Heapsort</option>
                <option value='mergesort'>Merge sort</option>
                <option value='introsort'>Introsort</option>
              </select>
            </div>
            <div id='bottom-pivot-1-div'>
              <label for='#bottom-pivot-1'>Pivot choice</label>
              <select class='form-control' id='bottom-pivot-1'>
                <option value='random'>Random</option>
                <option value='first'>First</option>
                <option value='middle'>Middle</option>
                <option value='last'>Last</option>
                <option value='median3'>Median of 3</option>
              </select>
            </div>
          </div>
          <canvas id="bottom-bar-1">/<canvas>
        </div>
        <div class="column">
          <div class="algorithmInputs">
            <div>
              <label for='#bottom-comparison-2'>Algorithm</label>
              <select class='form-control' id='bottom-comparison-2'>
                <option value='bubblesort'>Bubble sort</option>
                <option value='selectionsort'>Selection sort</option>
                <option value='insertionsort'>Insertion sort</option>
                <option value='odd_even_sort'>Odd-even sort</option>
                <option value='cocktail_sort'>Cocktail sort</option>
                <option value='quicksort'>Quicksort</option>
                <option value='heapsort'>Heapsort</option>
                <option value='mergesort'>Merge sort</option>
                <option value='introsort'>Introsort</option>
              </select>
            </div>
            <div id='bottom-pivot-2-div'>
              <label for='#bottom-pivot-1'>Pivot choice</label>
              <select class='form-control' id='bottom-pivot-2'>
                <option value='random'>Random</option>
                <option value='first'>First</option>
                <option value='middle'>Middle</option>
                <option value='last'>Last</option>
                <option value='median3'>Median of 3</option>
              </select>
            </div>
          </div>
          <canvas id="bottom-bar-2"></canvas>
        </div>
      </div>
      <div class="row">
        <div style="width:50%">
          <canvas id="shared-line-chart"></canvas>
        </div>
      </div>
      <h2 id='sources'>Sources and Citations</h2>
      <p>All the sources I collected code and other information from are listed below for reference.</p>
      <p>I borrowed much of javascript code that handles the actual sorting of the arrays from Justin Johnson. His "AnimatedArray" object and subsequent sorting code is what drives much of the background computation for this project. See citations below for more information.</p>
      <ul>
        <li>index.html. <i>sorting.js</i>, commit d8d7a1a30c00fde2456acc1063d5e22929378681, Justin Johnson, 2015. <i>GitHub</i>, https://github.com/jcjohnson/sorting.js/blob/master/index.html</li>
        <li>sorting.js. <i>sorting.js</i>, commit d8d7a1a30c00fde2456acc1063d5e22929378681, Justin Johnson, 2015. <i>GitHub</i>, https://github.com/jcjohnson/sorting.js/blob/master/js/sorting.js</li>
      </ul>
      <p>Below is a formal listing of sources for all the sorting code explanations and pseudocode.</p>
      <ul>
        <li>"Bubble sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Bubble_sort. Accessed 2 November 2019. </li>
        <li>"Selection sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Selection_sort. Accessed 2 November 2019. </li>
        <li>"Data Structure and Algorithms Selection Sort." <i>TutorialsPoint</i>, https://www.tutorialspoint.com/data_structures_algorithms/selection_sort_algorithm.htm. Accessed 2 November 2019. </li>
        <li>"Insertion sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Insertion_sort. Accessed 2 November 2019. </li>
        <li>"Odd-even sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Odd%E2%80%93even_sort. Accessed 2 November 2019. </li>
        <li>"Cocktail shaker sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Cocktail_shaker_sort. Accessed 2 November 2019. </li>
        <li>"Quicksort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Quicksort. Accessed 2 November 2019. </li>
        <li>"Heapsort." <i>Wikipedia</i>, hthttps://en.wikipedia.org/wiki/Heapsort. Accessed 2 November 2019. </li>
        <li>"Merge sort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Merge_sort. Accessed 2 November 2019. </li>
        <li>"Data Structures - Merge Sort Algorithm." <i>TutorialsPoint</i>, https://www.tutorialspoint.com/data_structures_algorithms/merge_sort_algorithm.htm. Accessed 2 November 2019. </li>
        <li>"Introsort." <i>Wikipedia</i>, https://en.wikipedia.org/wiki/Introsort. Accessed 2 November 2019. </li>
      </ul>

      <h3>Author Info</h3>
      <p>Created and Designed by Jackson Hammond, SI 649 Individual Project Fall 2019.
    </div>

    <script>
      $(function() {
        var aa = null;

        ////////////////////////
        var ctx2 = document.getElementById("myChart2").getContext('2d');
        let firstData = Array.from({length: 20}, () => Math.floor(Math.random() * 40));
        var myChart = new Chart(ctx2, {
          type: 'bar',
          data: {
            labels: firstData,
            datasets: [{
              label: 'Array Value',
              data: firstData,
              backgroundColor: '#A9A9A9',
              borderColor: '#313131',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true,
                  display: false,
                },
                gridLines: {
                  color: "rgba(0, 0, 0, 0)",
                },
              }],
              xAxes: [{
                gridLines: {
                  color: "rgba(0, 0, 0, 0)",
                }
              }]
            },
            animation: false,
            legend: false,
          }
        });
        ////////////////////////

        ////////////////////////
        var ctx3 = document.getElementById("main-line-chart").getContext('2d');
        var mainLineChart = new Chart(ctx3, {
          type: 'line',
          data: {
            labels: [0],
            datasets: [
              {
                label: 'Number of Swaps',
                borderColor: "rgba(63, 160, 255, 0.8)",
                backgroundColor: "rgba(63, 160, 255, 0.2)",
                steppedLine: true,
                pointRadius: 1,
                data: [0],
              },
            ]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true
                },
                scaleLabel: {
                  display: true,
                  labelString: 'Number of Swaps'
                }
              }],
              xAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: 'Algorithm Step Count'
                }
              }]
            }
          }
        });
        ////////////////////////

        // Disable / enable the pivot select as needed
        var update_pivot_select = function() {
          var algo = $('#algo-select').val();
          var pivot_algo = sorting.is_pivot_algo(algo);
          $('#pivot-select').prop('disabled', !pivot_algo);
          $('#pivot-select-div').toggleClass('hidden', !pivot_algo);
        }
        update_pivot_select();
        $('#algo-select').change(update_pivot_select);

        // Fisher-Yates shuffle algorithm
        // Source I grabbed it from: https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
        function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
        }

        let resetArray = function() {
          if (aa !== null) aa.cancel();
          mainLineChart.data.datasets[0].data = [0];
          mainLineChart.data.labels = [0];
          mainLineChart.update();
          let nextSize = $('#array-size').val();
          let nextInitCond = $('#init-select').val();
          let nextData = [...Array(parseInt(nextSize)).keys()].map(x => ++x);

          if (nextInitCond === 'random') {
            shuffleArray(nextData);
          } else if (nextInitCond === 'reversed') {
            nextData = nextData.reverse();
          }

          myChart.data.datasets[0].data = nextData;
          myChart.data.labels = nextData;
          myChart.update();
        }
        resetArray();
        $('#array-size').change(resetArray);
        $('#init-select').change(resetArray);
        $('#resetBtn').click(resetArray);

        $('#start-btn').click(function() {
          if (aa !== null) aa.cancel();
          mainLineChart.data.datasets[0].data = [0];
          mainLineChart.data.labels = [0];
          mainLineChart.update();

          var n = parseInt($('#array-size').val());
          var interval = parseInt($('#interval').val());
          var algo = $('#algo-select').val();
          var pivot_type = $('#pivot-select').val();
          var sort_fn = sorting.get_sort_fn(algo, pivot_type);

          if (algo === 'bitonic_mergesort') {
            // Round up to the nearest power of 2
            var n2 = 1;
            while (n2 < n) n2 *= 2;
            $('#array-size').val(n2);
            n = n2;
          }

          ary = myChart.data.datasets[0].data;
          var init = $('#init-select').val();
          if (init === 'sorted') {
            ary.sort(function(a, b) { return a - b; });
          } else if (init === 'reversed') {
            ary.sort(function(a, b) {return b - a; });
          }

          var canvas = document.getElementById('main-canvas');


          aa = new sorting.AnimatedArray(ary, myChart, interval, mainLineChart, mainLineChart.data.datasets[0]);
          sort_fn(aa);
        });
      });
    </script>
    <script>
      $(function() {

        // let sharedData = Array.from({length: 20}, () => Math.floor(Math.random() * 40));

        var ctx1 = document.getElementById("bottom-bar-1").getContext('2d');
        let barData1 = Array.from({length: 20}, () => Math.floor(Math.random() * 40));
        var barChart1 = new Chart(ctx1, {
          type: 'bar',
          data: {
            labels: barData1,
            datasets: [{
              label: 'Array Value',
              data: barData1,
              backgroundColor: '#A9A9A9',
              borderColor: '#313131',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true,
                  display: false,
                },
                gridLines: {
                  color: "rgba(0, 0, 0, 0)",
                },
              }],
              xAxes: [{
                gridLines: {
                  color: "rgba(0, 0, 0, 0)",
                }
              }]
            },
            animation: false,
            legend: false,
          }
        });

      var ctx2 = document.getElementById("bottom-bar-2").getContext('2d');
      let barData2 = Array.from({length: 20}, () => Math.floor(Math.random() * 40));
      var barChart2 = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: barData2,
          datasets: [{
            label: 'Array Value',
            data: barData2,
            backgroundColor: '#A9A9A9',
            borderColor: '#313131',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true,
                display: false,
              },
              gridLines: {
                color: "rgba(0, 0, 0, 0)",
              },
            }],
            xAxes: [{
              gridLines: {
                color: "rgba(0, 0, 0, 0)",
              }
            }]
          },
          animation: false,
          legend: false,
        }
      });

    var ctxLast = document.getElementById("shared-line-chart").getContext('2d');
    var sharedLineChart = new Chart(ctxLast, {
      type: 'line',
      data: {
        labels: [0],
        datasets: [
          {
            label: 'Left Algorithm Swaps',
            borderColor: "rgba(63, 160, 255, 0.8)",
            backgroundColor: "rgba(63, 160, 255, 0.2)",
            steppedLine: true,
            pointRadius: 1,
            data: [0],
          },
          {
            label: 'Right Algorithm Swaps',
            borderColor: "rgba(255, 125, 61, 0.8)",
            backgroundColor: "rgba(255, 125, 61, 0.2)",
            steppedLine: true,
            pointRadius: 0,
            data: [0],
          },
        ]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            },
            scaleLabel: {
              display: true,
              labelString: 'Number of Swaps'
            }
          }],
          xAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Algorithm Step Count',
            }
          }]
        }
      }
    });

    // Disable / enable the pivot select as needed
    var update_pivot_select1 = function() {
      var algo = $('#bottom-comparison-1').val();
      var pivot_algo = sorting.is_pivot_algo(algo);
      $('#bottom-pivot-1').prop('disabled', !pivot_algo);
      $('#bottom-pivot-1-div').toggleClass('hidden', !pivot_algo);
    }
    update_pivot_select1();
    $('#bottom-comparison-1').change(update_pivot_select1);

    var update_pivot_select2 = function() {
      var algo = $('#bottom-comparison-2').val();
      var pivot_algo = sorting.is_pivot_algo(algo);
      $('#bottom-pivot-2').prop('disabled', !pivot_algo);
      $('#bottom-pivot-2-div').toggleClass('hidden', !pivot_algo);
    }
    update_pivot_select2();
    $('#bottom-comparison-2').change(update_pivot_select2);

    $('#resetRace').click(function() {

      let newData = Array.from({length: 20}, () => Math.floor(Math.random() * 40));
      barChart1.data.datasets[0].data = newData;
      barChart1.data.labels = newData;
      barChart1.update();

      newData = Array.from({length: 20}, () => Math.floor(Math.random() * 40));
      barChart2.data.datasets[0].data = newData;
      barChart2.data.labels = newData;
      barChart2.update();
    });

    $('#startRace').click(function() {
      sharedLineChart.data.datasets[0].data = [0];
      sharedLineChart.data.datasets[1].data = [0];
      sharedLineChart.data.labels = [0];
      sharedLineChart.update();

      var algo = $('#bottom-comparison-1').val();
      var pivot_type = $('#bottom-pivot-1').val();
      var sort_fn1 = sorting.get_sort_fn(algo, pivot_type);

      var algo = $('#bottom-comparison-2').val();
      var pivot_type = $('#bottom-pivot-2').val();
      var sort_fn2 = sorting.get_sort_fn(algo, pivot_type);

      var animation1 = new sorting.AnimatedArray(barChart1.data.datasets[0].data, barChart1, 100, sharedLineChart, sharedLineChart.data.datasets[0]);
      sort_fn1(animation1);
      var animation2 = new sorting.AnimatedArray(barChart2.data.datasets[0].data, barChart2, 100, sharedLineChart, sharedLineChart.data.datasets[1]);
      sort_fn2(animation2);
      });
    });
    </script>
  </body>
</html>
